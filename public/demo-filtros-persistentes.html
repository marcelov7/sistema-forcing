<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo - Filtros Persistentes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-filter"></i> Demo Filtros Persistentes
            </a>
        </div>
    </nav>

    <main class="container-fluid mt-4">
        <div class="container-fluid px-3">
            <!-- Header -->
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3">
                <div class="mb-2 mb-md-0">
                    <h1 class="h3 mb-0"><i class="fas fa-filter"></i> Sistema de Filtros Persistentes</h1>
                    <small class="text-muted">Demonstra√ß√£o das melhorias implementadas</small>
                </div>
                <div class="d-flex flex-column flex-sm-row gap-2">
                    <button class="btn btn-outline-primary btn-sm" onclick="window.location.reload();">
                        <i class="fas fa-sync-alt"></i> 
                        <span class="d-none d-sm-inline">Atualizar</span>
                    </button>
                    <button class="btn btn-success btn-sm" onclick="testarPersistencia()">
                        <i class="fas fa-test-tube"></i> 
                        <span class="d-none d-sm-inline">Testar</span>
                    </button>
                </div>
            </div>

            <!-- Painel de Filtros -->
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">
                            <i class="fas fa-filter"></i> Filtros
                            <span id="filtrosAtivosBadge" class="badge bg-primary ms-2 d-none">
                                <i class="fas fa-check"></i> Ativos
                            </span>
                        </h6>
                        <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#filtrosCollapse">
                            <i class="fas fa-chevron-down"></i> <span class="d-none d-sm-inline">Expandir</span>
                        </button>
                    </div>
                </div>
                <div class="collapse show" id="filtrosCollapse">
                    <div class="card-body">
                        <form method="GET" action="#" id="filtroForm">
                            <!-- Filtros Principais -->
                            <div class="row g-2 mb-3">
                                <div class="col-12 col-md-6">
                                    <label class="form-label small">üîç Buscar</label>
                                    <input type="text" class="form-control" name="busca" 
                                           value="" placeholder="Digite para buscar...">
                                </div>
                                <div class="col-6 col-md-3">
                                    <label class="form-label small">üìä Status</label>
                                    <select class="form-select" name="status">
                                        <option value="todos">Todos</option>
                                        <option value="pendente">‚è≥ Pendente</option>
                                        <option value="liberado">‚úÖ Liberado</option>
                                        <option value="forcado">‚ö†Ô∏è For√ßado</option>
                                        <option value="retirado">‚úÖ‚úÖ Retirado</option>
                                    </select>
                                </div>
                                <div class="col-6 col-md-3">
                                    <label class="form-label small">üè≠ √Årea</label>
                                    <select class="form-select" name="area">
                                        <option value="todas">Todas</option>
                                        <option value="producao">Produ√ß√£o</option>
                                        <option value="manutencao">Manuten√ß√£o</option>
                                        <option value="qualidade">Qualidade</option>
                                        <option value="logistica">Log√≠stica</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Filtros Avan√ßados -->
                            <div class="row g-2 mb-3">
                                <div class="col-6 col-md-3">
                                    <label class="form-label small">‚öôÔ∏è Situa√ß√£o</label>
                                    <select class="form-select" name="situacao">
                                        <option value="todas">Todas</option>
                                        <option value="ativado">üü¢ Ativado</option>
                                        <option value="desativado">üî¥ Desativado</option>
                                        <option value="ativacao_futura">üü° Ativa√ß√£o Futura</option>
                                    </select>
                                </div>
                                <div class="col-6 col-md-3">
                                    <label class="form-label small">üë§ Criador</label>
                                    <select class="form-select" name="criador">
                                        <option value="todos">Todos</option>
                                        <option value="1">Jo√£o Silva</option>
                                        <option value="2">Maria Santos</option>
                                        <option value="3">Pedro Costa</option>
                                    </select>
                                </div>
                                <div class="col-6 col-md-3">
                                    <label class="form-label small">üìÖ Data In√≠cio</label>
                                    <input type="date" class="form-control" name="data_inicio">
                                </div>
                                <div class="col-6 col-md-3">
                                    <label class="form-label small">üìÖ Data Fim</label>
                                    <input type="date" class="form-control" name="data_fim">
                                </div>
                            </div>

                            <!-- Bot√µes de A√ß√£o -->
                            <div class="row g-2">
                                <div class="col-12">
                                    <div class="d-flex flex-wrap gap-2 justify-content-start">
                                        <button type="submit" class="btn btn-primary btn-sm">
                                            <i class="fas fa-search"></i> <span class="d-none d-sm-inline">Filtrar</span>
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="limparTodosFiltros()" title="Limpar todos os filtros">
                                            <i class="fas fa-times"></i> <span class="d-none d-sm-inline">Limpar</span>
                                        </button>
                                        <button type="button" class="btn btn-outline-info btn-sm" onclick="mostrarFiltrosAtivos()" title="Ver filtros ativos">
                                            <i class="fas fa-info-circle"></i> <span class="d-none d-sm-inline">Info</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Instru√ß√µes de Teste -->
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-info-circle"></i> Como Testar a Persist√™ncia</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>‚úÖ Funcionalidades Implementadas:</h6>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">
                                    <i class="fas fa-check text-success"></i> 
                                    <strong>Auto-save:</strong> Filtros salvos automaticamente
                                </li>
                                <li class="list-group-item">
                                    <i class="fas fa-check text-success"></i> 
                                    <strong>Persist√™ncia:</strong> Mant√©m filtros entre navega√ß√µes
                                </li>
                                <li class="list-group-item">
                                    <i class="fas fa-check text-success"></i> 
                                    <strong>Indicador visual:</strong> Badge mostra filtros ativos
                                </li>
                                <li class="list-group-item">
                                    <i class="fas fa-check text-success"></i> 
                                    <strong>Bot√£o limpar:</strong> Remove todos os filtros
                                </li>
                                <li class="list-group-item">
                                    <i class="fas fa-check text-success"></i> 
                                    <strong>Modal info:</strong> Mostra filtros ativos
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>üß™ Passos para Testar:</h6>
                            <ol class="list-group list-group-numbered">
                                <li class="list-group-item">
                                    <strong>1.</strong> Aplique alguns filtros (ex: Status = "Pendente")
                                </li>
                                <li class="list-group-item">
                                    <strong>2.</strong> Observe o badge "Ativos" aparecer
                                </li>
                                <li class="list-group-item">
                                    <strong>3.</strong> Clique em "Atualizar" para simular navega√ß√£o
                                </li>
                                <li class="list-group-item">
                                    <strong>4.</strong> Verifique se os filtros foram mantidos
                                </li>
                                <li class="list-group-item">
                                    <strong>5.</strong> Clique em "Info" para ver filtros ativos
                                </li>
                                <li class="list-group-item">
                                    <strong>6.</strong> Clique em "Limpar" para resetar
                                </li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Sistema de persist√™ncia de filtros (mesmo c√≥digo da implementa√ß√£o)
        const FILTERS_STORAGE_KEY = 'demo_forcing_filters';

        function salvarFiltros() {
            try {
                const form = document.getElementById('filtroForm');
                const formData = new FormData(form);
                const filters = {};
                
                for (let [key, value] of formData.entries()) {
                    if (value && value !== 'todos' && value !== 'todas') {
                        filters[key] = value;
                    }
                }
                
                localStorage.setItem(FILTERS_STORAGE_KEY, JSON.stringify(filters));
                console.log('Filtros salvos:', filters);
                atualizarIndicadorFiltros();
            } catch (error) {
                console.error('Erro ao salvar filtros:', error);
            }
        }

        function carregarFiltros() {
            try {
                const savedFilters = localStorage.getItem(FILTERS_STORAGE_KEY);
                if (savedFilters) {
                    const filters = JSON.parse(savedFilters);
                    const form = document.getElementById('filtroForm');
                    
                    Object.keys(filters).forEach(key => {
                        const element = form.querySelector(`[name="${key}"]`);
                        if (element) {
                            element.value = filters[key];
                        }
                    });
                    
                    console.log('Filtros carregados:', filters);
                    atualizarIndicadorFiltros();
                    return Object.keys(filters).length > 0;
                }
            } catch (error) {
                console.error('Erro ao carregar filtros:', error);
            }
            return false;
        }

        function atualizarIndicadorFiltros() {
            try {
                const badge = document.getElementById('filtrosAtivosBadge');
                const form = document.getElementById('filtroForm');
                
                if (!badge || !form) return;
                
                const formData = new FormData(form);
                let filtrosAtivos = 0;
                
                for (let [key, value] of formData.entries()) {
                    if (value && value !== 'todos' && value !== 'todas') {
                        filtrosAtivos++;
                    }
                }
                
                if (filtrosAtivos > 0) {
                    badge.classList.remove('d-none');
                    badge.innerHTML = `<i class="fas fa-check"></i> ${filtrosAtivos} Ativo${filtrosAtivos > 1 ? 's' : ''}`;
                } else {
                    badge.classList.add('d-none');
                }
            } catch (error) {
                console.error('Erro ao atualizar indicador de filtros:', error);
            }
        }

        function limparTodosFiltros() {
            try {
                localStorage.removeItem(FILTERS_STORAGE_KEY);
                const form = document.getElementById('filtroForm');
                form.reset();
                
                const statusSelect = form.querySelector('select[name="status"]');
                const areaSelect = form.querySelector('select[name="area"]');
                const situacaoSelect = form.querySelector('select[name="situacao"]');
                const criadorSelect = form.querySelector('select[name="criador"]');
                
                if (statusSelect) statusSelect.value = 'todos';
                if (areaSelect) areaSelect.value = 'todas';
                if (situacaoSelect) situacaoSelect.value = 'todas';
                if (criadorSelect) criadorSelect.value = 'todos';
                
                atualizarIndicadorFiltros();
                console.log('Filtros limpos');
            } catch (error) {
                console.error('Erro ao limpar filtros:', error);
            }
        }

        function mostrarFiltrosAtivos() {
            try {
                const form = document.getElementById('filtroForm');
                const formData = new FormData(form);
                const filtrosAtivos = [];
                
                const labels = {
                    'busca': 'Busca',
                    'status': 'Status',
                    'area': '√Årea',
                    'situacao': 'Situa√ß√£o',
                    'criador': 'Criador',
                    'data_inicio': 'Data In√≠cio',
                    'data_fim': 'Data Fim'
                };
                
                for (let [key, value] of formData.entries()) {
                    if (value && value !== 'todos' && value !== 'todas') {
                        const label = labels[key] || key;
                        filtrosAtivos.push(`${label}: <strong>${value}</strong>`);
                    }
                }
                
                if (filtrosAtivos.length > 0) {
                    const mensagem = `
                        <div class="alert alert-info">
                            <h6><i class="fas fa-filter"></i> Filtros Ativos:</h6>
                            <ul class="mb-0">
                                ${filtrosAtivos.map(filtro => `<li>${filtro}</li>`).join('')}
                            </ul>
                        </div>
                        <p class="text-muted">Os filtros s√£o mantidos automaticamente at√© que voc√™ clique em "Limpar".</p>
                    `;
                    
                    const modalHTML = `
                        <div class="modal fade" id="filtrosModal" tabindex="-1">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Filtros Ativos</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body">
                                        ${mensagem}
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                                        <button type="button" class="btn btn-warning" onclick="limparTodosFiltros()" data-bs-dismiss="modal">
                                            <i class="fas fa-times"></i> Limpar Filtros
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    const existingModal = document.getElementById('filtrosModal');
                    if (existingModal) {
                        existingModal.remove();
                    }
                    
                    document.body.insertAdjacentHTML('beforeend', modalHTML);
                    const modal = new bootstrap.Modal(document.getElementById('filtrosModal'));
                    modal.show();
                } else {
                    alert('Nenhum filtro est√° ativo no momento.');
                }
            } catch (error) {
                console.error('Erro ao mostrar filtros ativos:', error);
            }
        }

        function testarPersistencia() {
            // Aplicar alguns filtros de exemplo
            const form = document.getElementById('filtroForm');
            const statusSelect = form.querySelector('select[name="status"]');
            const areaSelect = form.querySelector('select[name="area"]');
            
            if (statusSelect) statusSelect.value = 'pendente';
            if (areaSelect) areaSelect.value = 'producao';
            
            salvarFiltros();
            
            alert('Filtros de exemplo aplicados! Clique em "Atualizar" para testar a persist√™ncia.');
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Demo de filtros persistentes carregado');
            
            // Carregar filtros salvos
            carregarFiltros();
            
            // Adicionar eventos
            const form = document.getElementById('filtroForm');
            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    salvarFiltros();
                    alert('Formul√°rio submetido! Filtros salvos.');
                });
                
                let saveTimeout;
                const inputs = form.querySelectorAll('input, select');
                inputs.forEach(input => {
                    input.addEventListener('change', function() {
                        clearTimeout(saveTimeout);
                        saveTimeout = setTimeout(() => {
                            salvarFiltros();
                        }, 500);
                    });
                });
            }
        });
    </script>
</body>
</html>
